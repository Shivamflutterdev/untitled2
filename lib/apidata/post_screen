import 'package:flutter/material.dart';
import 'package:get/get.dart';
import '../controller/post_controller.dart';
import '../model/post_model.dart';

class PostScreen extends StatelessWidget {

  final controller = Get.put(PostController());

  final titleController = TextEditingController();
  final bodyController = TextEditingController();

  @override
  Widget build(BuildContext context) {

    return Scaffold(

      appBar: AppBar(
        title: Text("API CRUD GetX"),
      ),

      body: Column(

        children: [

          Padding(
            padding: EdgeInsets.all(10),
            child: Column(
              children: [

                TextField(
                  controller: titleController,
                  decoration: InputDecoration(
                    hintText: "Title",
                  ),
                ),

                TextField(
                  controller: bodyController,
                  decoration: InputDecoration(
                    hintText: "Body",
                  ),
                ),

                ElevatedButton(
                  onPressed: () {

                    final post = Post(
                      title: titleController.text,
                      body: bodyController.text,
                    );

                    controller.addPost(post);
                  },
                  child: Text("Add Post"),
                ),
              ],
            ),
          ),

          Expanded(
            child: Obx(() {

              if (controller.isLoading.value) {
                return Center(
                  child: CircularProgressIndicator(),
                );
              }

              return ListView.builder(

                itemCount:
                    controller.postList.length,

                itemBuilder: (context, index) {

                  final post =
                      controller.postList[index];

                  return ListTile(

                    title: Text(post.title),

                    subtitle: Text(post.body),

                    trailing: Row(
                      mainAxisSize:
                          MainAxisSize.min,
                      children: [

                        IconButton(
                          icon: Icon(Icons.edit),
                          onPressed: () {

                            post.title =
                                "Updated Title";

                            controller
                                .updatePost(post);
                          },
                        ),

                        IconButton(
                          icon: Icon(Icons.delete),
                          onPressed: () {

                            controller
                                .deletePost(post.id!);
                          },
                        ),
                      ],
                    ),
                  );
                },
              );
            }),
          )
        ],
      ),
    );
  }
}
